(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"./app/src/components/AtlassianAccountMigration/AtlassianAccountMigrationError.tsx":function(e,t,n){"use strict";n.r(t),n.d(t,"AtlassianAccountMigrationError",(function(){return N}));var a=n("./node_modules/react/index.js"),r=n.n(a),o=n("./packages/atlassian-analytics/index.ts"),i=n("./app/src/components/AtlassianAccountMigration/Analytics.ts"),s=n("./packages/config/index.ts"),l=n("./packages/graphql/generated.tsx"),c=n("./app/common/lib/util/i18n/index.ts"),u=n("./app/src/components/EmailError/index.ts"),m=n("./app/src/components/ChangeEmailButton/index.ts"),d=n("./app/src/components/Wizard/index.ts"),p=n("./app/common/components/controls/button/button.tsx"),g=n("./packages/analytics/index.ts"),f=n("./app/src/components/AtlassianAccountMigration/EmailMismatchErrorDialog.less"),b=n.n(f),h=n("./app/src/components/AtlassianAccountMigration/EmailMigrationDialog.tsx");function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function E(e,t,n,a,r,o,i){try{var s=e[o](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(a,r)}function A(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var o=e.apply(t,n);function i(e){E(o,a,r,i,s,"next",e)}function s(e){E(o,a,r,i,s,"throw",e)}i(void 0)}))}}var j={main:{full:n("./resources/images/aa-migration-wizard/illustration-error.svg"),mobile:n("./resources/images/aa-migration-wizard/illustration-error-mobile.svg")},email:{full:n("./resources/images/aa-migration-wizard/illustration-email.svg"),mobile:n("./resources/images/aa-migration-wizard/illustration-email-mobile.svg")}},x=function(){var e=A(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.fetch(t);case 2:if(!(null==(n=e.sent)?void 0:n.ok)){e.next=5;break}return e.abrupt("return",n.text());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=Object(c.forNamespace)(["aa migration wizard","email mismatch error"],{shouldEscapeStrings:!1}),w=new Map,I=function(e){var t=w.get(e);if(t)return t;var n=document.createElement("div");return n.className=b.a.illustration,w.set(e,n),x(e).then((function(e){e&&(n.innerHTML=e)})),n},M=function(e){var t=e.accounts,n=e.onClickMigrate,c=e.onDismiss,f=v(Object(a.useState)(),2),y=f[0],E=f[1];Object(a.useEffect)((function(){I(j.main.full),I(j.main.mobile)})),Object(a.useEffect)((function(){Object(i.b)(o.Source.aaMigrationWizardEmailMismatchScreen,{})}),[]);var x=v(Object(l.G)(),2),w=x[0],M=x[1],_=v(Object(a.useState)(u.b.None),2),k=_[0],C=_[1],O=function(){var e=A(regeneratorRuntime.mark((function e(n){var a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C(u.b.None),e.prev=1,t.trello.loginId){e.next=4;break}throw Error("No login ID provided");case 4:return e.next=6,w({variables:{loginId:t.trello.loginId,email:n}});case 6:E(n),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),a=e.t0.networkError?e.t0.networkError.message:e.t0.message,(r=Object(u.c)(a))?C(r):(console.error("Failed to change email",e.t0),C(u.b.Unknown));case 14:Object(i.a)({verb:g.Verb.CHANGES,noun:g.Noun.EMAIL,method:"by clicking change email button",context:{},source:o.Source.atlassianAccountMigrationChangeEmailInlineDialog,action:o.Action.clicked,actionSubject:o.ActionSubject.button,actionSubjectId:o.ActionSubjectId.atlassianAccountMigrationChangeEmailButton});case 15:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),D=Object(a.useCallback)((function(e){e&&Object(i.b)(o.Source.atlassianAccountMigrationChangeEmailInlineDialog,{})}),[]),N=Object(a.useCallback)((function(){c(),Object(i.a)({verb:g.Verb.DISMISSES,noun:g.Noun.AA_MIGRATION_WIZARD,method:"by dismissing the migration dialog",context:{},source:o.Source.aaMigrationWizardEmailMismatchScreen,action:o.Action.closed,actionSubject:o.ActionSubject.overlay,actionSubjectId:o.ActionSubjectId.atlassianAccountMigrationOverlay})}),[c]);return y?r.a.createElement(h.a,{image:I(j.email.full),mobileImage:I(j.email.mobile),email:y,closeDialog:N}):r.a.createElement(d.a,{closeDialog:N,title:S("title",{email:t.trello.email}),image:I(j.main.full),mobileImage:I(j.main.mobile)},r.a.createElement("div",{className:b.a.content},r.a.createElement("div",{className:b.a.description},r.a.createElement("p",{className:b.a.mainMessage},S("main-message")),r.a.createElement("p",null,S("secondary-message")),r.a.createElement("ul",null,r.a.createElement("li",{key:"log-in-with-aa-email"},S("log-in-to-atlassian-with-email",{email:t.trello.email})),r.a.createElement("li",{key:"change-your-trello-email"},S("change-your-email-address-for-trello")),r.a.createElement("li",{key:"change-your-atlassian-email"},S("change-your-email-address-for-atlassian",{atlassianAccount:r.a.createElement("a",{key:"aa-change-email-link",href:s.identityBaseUrl+"/manage-profile/email",target:"_blank"},S("atlassian-account"))})))),r.a.createElement("div",{className:b.a.buttons},r.a.createElement(p.g,{onClick:n},S("log-in-to-atlassian")),t.trello.loginId&&r.a.createElement(m.a,{emailError:k,onSubmitEmail:O,onTogglePopover:D,isSendingRequest:M.loading,emailPlaceholder:t.atlassian.email||""},S("change-trello-email")))))},_=n("./app/src/components/AtlassianAccountMigration/AtlassianAccountMigrationErrorCodes.ts"),k=n("./app/src/components/Spinner/index.ts"),C=n("./app/src/components/AtlassianAccountMigration/AtlassianAccountMigrationClient.ts");function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var N=function(e){var t=e.code,n=e.onRetry,s=e.onDismiss,l=O(Object(a.useState)(),2),c=l[0],u=l[1],m=Object(a.useCallback)((function(){s(),Object(i.a)({verb:g.Verb.INITIATES,noun:g.Noun.AA_MIGRATION_WIZARD,method:"by clicking log in with atlassian button",context:{},source:o.Source.atlassianAccountMigrationBanner,action:o.Action.clicked,actionSubject:o.ActionSubject.button,actionSubjectId:o.ActionSubjectId.atlassianAccountMigrationRetryButton}),n()}),[s,n]);switch(Object(a.useEffect)((function(){t===_.a.EMAIL_MISMATCH&&C.a.fetchAccountsInfo().then((function(e){return e&&u(e)}),(function(e){console.error("Failed to fetch emails",{err:e}),u({atlassian:{email:null},trello:{email:null,loginId:null}})}))}),[t]),t){case _.a.EMAIL_MISMATCH:return c?r.a.createElement(M,{onClickMigrate:m,accounts:c,onDismiss:s}):r.a.createElement(k.a,null);default:throw new Error("Unhandled error code: ".concat(t))}};t.default=N},"./app/src/components/AtlassianAccountMigration/EmailMismatchErrorDialog.less":function(e,t,n){var a=n("./node_modules/css-loader/index.js?!./node_modules/postcss-loader/src/index.js?!./node_modules/less-loader/dist/cjs.js?!./app/src/components/AtlassianAccountMigration/EmailMismatchErrorDialog.less");"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n("./node_modules/style-loader/lib/addStyles.js")(a,r);a.locals&&(e.exports=a.locals)},"./app/src/components/ChangeEmailButton/ChangeEmailButton.less":function(e,t,n){var a=n("./node_modules/css-loader/index.js?!./node_modules/postcss-loader/src/index.js?!./node_modules/less-loader/dist/cjs.js?!./app/src/components/ChangeEmailButton/ChangeEmailButton.less");"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n("./node_modules/style-loader/lib/addStyles.js")(a,r);a.locals&&(e.exports=a.locals)},"./app/src/components/ChangeEmailButton/index.ts":function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var a=n("./node_modules/react/index.js"),r=n.n(a),o=n("./node_modules/classnames/index.js"),i=n.n(o),s=n("./app/common/components/controls/button/button.tsx"),l=n("./app/common/lib/util/i18n/index.ts"),c=n("./packages/nachos/index.ts"),u=n("./app/src/components/EmailError/index.ts"),m=n("./app/src/components/PrimaryButton/index.ts"),d=n("./app/src/components/Spinner/index.ts"),p=n("./app/src/components/ChangeEmailButton/ChangeEmailButton.less"),g=n.n(p);function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var v=Object(l.forNamespace)(["email hygiene wizard","change email"],{shouldEscapeStrings:!1}),y=function(e){var t=e.disabled,n=void 0!==t&&t,o=e.onSubmitEmail,l=void 0===o?function(e){}:o,p=e.isSendingRequest,h=e.emailError,y=e.onTogglePopover,E=e.emailPlaceholder,A=void 0===E?"":E,j=e.children,x=b(Object(a.useState)(A),2),S=x[0],w=x[1],I=Object(c.usePopover)({onHide:function(){y(!1)},onShow:function(){y(!0)}}),M=I.popoverProps,_=I.toggle,k=I.triggerRef;return r.a.createElement(r.a.Fragment,null,r.a.createElement(s.a,{onClick:_,ref:k,disabled:n},j),r.a.createElement(c.Popover,f({},M,{title:v("title")}),r.a.createElement("div",{className:g.a.popoverContent},r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),l(S)}},r.a.createElement("div",null,v("main-message"),p&&r.a.createElement(d.a,{small:!0,inline:!0,wrapperClassName:i()(g.a.spinner,g.a.floating)})),h&&r.a.createElement(u.a,{error:h,email:S},(function(e){return r.a.createElement("p",{className:g.a.popoverError},e)})),r.a.createElement("label",{htmlFor:"email",className:g.a.popoverLabel},v("email-label")),r.a.createElement("input",{id:"email",type:"email",name:"email",value:S,ref:function(e){return e&&e.focus()},onChange:function(e){return w(e.target.value)},disabled:p}),r.a.createElement(m.a,{disabled:p||0===S.length,onClick:function(e){e.preventDefault(),l(S)}},v("send-confirmation-button"))))))}},"./node_modules/css-loader/index.js?!./node_modules/postcss-loader/src/index.js?!./node_modules/less-loader/dist/cjs.js?!./app/src/components/AtlassianAccountMigration/EmailMismatchErrorDialog.less":function(e,t,n){(t=e.exports=n("./node_modules/css-loader/lib/css-base.js")(!1)).push([e.i,"._3Bd6HnKKkhFGD_{display:flex;flex:1;flex-direction:column;max-height:328px}._3Bd6HnKKkhFGD_ .G69uEb3MtDy4ET{display:flex;flex-direction:column;overflow-y:auto}._3Bd6HnKKkhFGD_ ._2zWt-TAgMI95Ed{margin-top:30px}._3Bd6HnKKkhFGD_ ._2zWt-TAgMI95Ed button{margin-right:8px}._2KecRqjUIETpLX{word-wrap:break-word}@media only screen and (max-width:1020px){._3AU-NEKdBS7j3e{width:100%;min-width:375px}}._3Bd6HnKKkhFGD_ .G69uEb3MtDy4ET ul{list-style:disc;padding-left:16px}._3Bd6HnKKkhFGD_ .G69uEb3MtDy4ET ul li{word-break:break-word;margin-bottom:8px}",""]),t.locals={content:"_3Bd6HnKKkhFGD_",description:"G69uEb3MtDy4ET",buttons:"_2zWt-TAgMI95Ed",breakable:"_2KecRqjUIETpLX",illustration:"_3AU-NEKdBS7j3e"}},"./node_modules/css-loader/index.js?!./node_modules/postcss-loader/src/index.js?!./node_modules/less-loader/dist/cjs.js?!./app/src/components/ChangeEmailButton/ChangeEmailButton.less":function(e,t,n){(t=e.exports=n("./node_modules/css-loader/lib/css-base.js")(!1)).push([e.i,"._3Ix0WjhiPcwnS2{padding:12px;color:#5e6c84}._3Ix0WjhiPcwnS2 input{width:100%}._3Ix0WjhiPcwnS2 button{width:100%;margin:16px 0 0}.jdTcFpD3-nI6Sm{margin:16px 0 8px;font-weight:700;font-size:14px;color:#172b4d}._1NYql4rFP67pCj{margin:8px 0;font-weight:700;color:#b04632}",""]),t.locals={popoverContent:"_3Ix0WjhiPcwnS2",popoverLabel:"jdTcFpD3-nI6Sm",popoverError:"_1NYql4rFP67pCj"}},"./resources/images/aa-migration-wizard/illustration-error-mobile.svg":function(e,t,n){e.exports=n.p+"images/aa-migration-wizard/illustration-error-mobile.f1d7cd8e9f994511de69.svg"},"./resources/images/aa-migration-wizard/illustration-error.svg":function(e,t,n){e.exports=n.p+"images/aa-migration-wizard/illustration-error.04f84878bae2a86e48d7.svg"}}]);
//# sourceMappingURL=aa-migration-error.3ec9502730881d3ac22d.js.map