(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{"./app/src/components/EmailHygieneWizard/Analytics.ts":function(e,n,t){"use strict";t.d(n,"a",(function(){return i})),t.d(n,"b",(function(){return o}));var a=t("./packages/analytics/index.ts"),r=t("./packages/atlassian-analytics/index.ts"),i=function(e){var n=e.verb,t=e.noun,i=e.method,o=e.context,c=e.actionSubject,s=e.actionSubjectId,l=e.action,u=e.source;Object(a.trackUe)({category:a.Noun.EMAIL_HYGIENE,verb:n,directObj:t,method:i,context:JSON.stringify(o)}),r.Analytics.sendUIEvent({action:l,actionSubject:c,actionSubjectId:s,source:u,attributes:o})},o=function(e,n){Object(a.trackUe)({category:a.Noun.EMAIL_HYGIENE,verb:a.Verb.VIEWS,directObj:e,context:JSON.stringify(n)}),r.Analytics.sendScreenEvent({name:e,attributes:n})}},"./app/src/components/EmailHygieneWizard/EmailHygieneBanner.less":function(e,n,t){var a=t("./node_modules/css-loader/index.js?!./node_modules/postcss-loader/src/index.js?!./node_modules/less-loader/dist/cjs.js?!./app/src/components/EmailHygieneWizard/EmailHygieneBanner.less");"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t("./node_modules/style-loader/lib/addStyles.js")(a,r);a.locals&&(e.exports=a.locals)},"./app/src/components/EmailHygieneWizard/getCanCompleteEmailHygiene.ts":function(e,n,t){"use strict";t.d(n,"b",(function(){return r})),t.d(n,"a",(function(){return i})),t.d(n,"c",(function(){return o}));var a=t("./packages/dates/index.ts"),r="primary-email-hygiene",i="peh-change-email";function o(e){var n,t,o=!!(null===(n=e.oneTimeMessagesDismissed)||void 0===n?void 0:n.includes(r)),c=!!(null===(t=e.oneTimeMessagesDismissed)||void 0===t?void 0:t.includes(i)),s=e.logins.sort((function(e,n){return e.id.localeCompare(n.id)}))[0],l=s&&(Date.now()-Object(a.c)(s.id).valueOf())/1e3/60/60/24;return!(!e.confirmed||e.idEnterprise||!(!l||l>7||c)||e.isAaMastered||e.aaEnrolledDate||o)}},"./app/src/components/EmailHygieneWizard/index.ts":function(e,n,t){"use strict";t.r(n),t.d(n,"EmailHygieneBanner",(function(){return w})),t.d(n,"getCanCompleteEmailHygiene",(function(){return v.c})),t.d(n,"HYGIENE_MESSAGE_ID",(function(){return v.b})),t.d(n,"CHANGE_EMAIL_MESSAGE_ID",(function(){return v.a}));var a=t("./node_modules/react/index.js"),r=t.n(a),i=t("./packages/analytics/index.ts"),o=t("./packages/atlassian-analytics/index.ts"),c=t("./packages/colors/index.ts"),s=t("./packages/feature-flag-client/index.ts"),l=t("./packages/graphql/generated.tsx"),u=t("./packages/locale/index.ts"),d=t("./packages/dates/index.ts"),m=t("./packages/storage/index.ts"),p=t("./app/common/components/banner/banner.tsx"),b=t("./app/common/lib/util/i18n/index.ts"),f=t("./app/src/components/Overlay/index.ts"),g=t("./app/src/components/EmailHygieneWizard/Analytics.ts"),y=t("./app/src/components/EmailHygieneWizard/EmailHygieneBanner.less"),E=t.n(y),v=t("./app/src/components/EmailHygieneWizard/getCanCompleteEmailHygiene.ts"),S=t("./app/src/components/EmailHygieneWizard/useSnooze.ts");function j(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],a=!0,r=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(a=(o=c.next()).done)&&(t.push(o.value),!n||t.length!==n);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==c.return||c.return()}finally{if(r)throw i}}return t}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return h(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return h(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=new Array(n);t<n;t++)a[t]=e[t];return a}var I,x=new Date(2020,5,1),O=t.e(27).then(t.bind(null,"./app/src/components/EmailHygieneWizard/EmailHygieneWizard.tsx")),k=Object(a.lazy)((function(){return O})),A=Object(b.forNamespace)(["email hygiene wizard","banner"],{shouldEscapeStrings:!1}),w=function(e){var n,t,y=e.forceShow,h=j(Object(a.useState)(!1),2),O=h[0],w=h[1],H=j(Object(a.useState)(!1),2),C=H[0],N=H[1],z=j(Object(a.useState)(!1),2),_=z[0],D=z[1],L=Object(s.useFeatureFlag)("aa4a.show-email-hygiene",!1),M=Object(s.useFeatureFlag)("aa4a.show-peh-countdown",!1),W=Object(s.useFeatureFlag)("aa4a.show-peh-past-deadline",!1),F=Object(s.useFeatureFlag)("aa4a.peh-snooze-time",0),T=Object(S.a)("peh-snooze",F),B=T.isSnoozed,G=T.snooze,U=Object(l.lb)({variables:{memberId:"me"}}),R=U.data&&U.data.member,V=new Date>x,q=_&&M&&!V;Object(a.useEffect)((function(){if(null==R?void 0:R.logins){var e,n=Object(v.c)(R),t=!!(null===(e=R.oneTimeMessagesDismissed)||void 0===e?void 0:e.includes(v.a)),a=y||/[?&]forceHygiene=true/i.test(window.location.search);B?(N(!1),w(!1)):a?(w(!0),N(!0)):n?(t||L)&&(w(!0),N(!0)):w(!1),m.Storage.get("peh-seen-initial-banner")&&D(!0)}}),[R,y,L,B]);var Y=Object(a.useCallback)((function(){U.refetch(),N(!0),Object(g.a)({verb:i.Verb.INITIATES,noun:i.Noun.EMAIL_HYGIENE_WIZARD,method:"by clicking banner link",context:I,source:o.Source.emailHygieneBanner,action:o.Action.clicked,actionSubject:o.ActionSubject.link,actionSubjectId:o.ActionSubjectId.emailHygieneBannerLink})}),[U]),J=Object(a.useCallback)((function(){G(),Object(g.a)({verb:i.Verb.DISMISSES,noun:i.Noun.EMAIL_HYGIENE_WIZARD,method:"by clicking remind me later link",context:I,source:o.Source.emailHygieneBanner,action:o.Action.clicked,actionSubject:o.ActionSubject.link,actionSubjectId:o.ActionSubjectId.emailHygieneBannerDismissLink})}),[G]),K=R&&Array.from(R.logins);K&&K.sort((function(e,n){return(n.primary?1:0)-(e.primary?1:0)||n.id.localeCompare(e.id)})),!I&&R&&(I={organizationId:R.idEnterprise,totalEmailAddresses:null==K?void 0:K.length,totalClaimableEmailAddresses:null==K?void 0:K.filter((function(e){return e.claimable})).length});var X,P=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"#",className:E.a.updateLink,onClick:function(e){e.preventDefault(),Y()}},A("link-text")),F>0&&r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{className:E.a.linkSeparator},"Â·"),r.a.createElement("a",{href:"#",className:E.a.dismissLink,onClick:function(e){e.preventDefault(),J()}},A("snooze-link-text"))))};return Object(a.useEffect)((function(){O&&Object(g.b)(o.Source.emailHygieneBanner,I)}),[O]),R&&K?r.a.createElement("div",null,O&&r.a.createElement(r.a.Fragment,null,V&&W?r.a.createElement(p.a,{className:E.a.banner,bannerColor:c.N800},r.a.createElement("p",{className:E.a.text},A("past-deadline-message"),P())):q?(X=Math.ceil(Object(d.a)(new Date,x,!0)),r.a.createElement(p.a,{className:E.a.banner,bannerColor:c.N800},r.a.createElement("p",{className:E.a.text},r.a.createElement("strong",null,Object(b.localizeCount)("peh-countdown-banner-days",X,{days:X})),r.a.createElement("br",null),A("countdown-message",{date:x.toLocaleDateString(u.currentLocale,{month:"long",day:"numeric"})}),P()))):(m.Storage.set("peh-seen-initial-banner","true"),r.a.createElement(p.a,{className:E.a.banner,bannerColor:c.N800},r.a.createElement("p",{className:E.a.text},r.a.createElement("span",{role:"img","aria-label":""},"ðŸ‘‹"),A("main-message",{name:R&&R.fullName}),P())))),C&&r.a.createElement(f.a,{background:f.c.LIGHT,closeOnEscape:!1,onClose:function(){},alignment:f.b.TOP},r.a.createElement(a.Suspense,{fallback:null},r.a.createElement(k,{logins:K,name:R.fullName||R.username,hasTwoFactor:!!(null===(n=R.prefs)||void 0===n||null===(t=n.twoFactor)||void 0===t?void 0:t.enabled),avatarUrl:R.avatarUrl||void 0,initials:R.initials||void 0,onDismiss:function(){return N(!1)},onSnooze:F?G:void 0,analyticsContext:I,onComplete:function(){w(!1),N(!1)}})))):null}},"./app/src/components/EmailHygieneWizard/useSnooze.ts":function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var a=t("./node_modules/react/index.js");function r(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],a=!0,r=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(a=(o=c.next()).done)&&(t.push(o.value),!n||t.length!==n);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==c.return||c.return()}finally{if(r)throw i}}return t}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return i(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return i(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=new Array(n);t<n;t++)a[t]=e[t];return a}function o(e,n){var t=r(Object(a.useState)(!1),2),i=t[0],o=t[1],c=Object(a.useCallback)((function(){var t=!1,a=localStorage.getItem(e);if(a){var r=1e3*n,i=parseInt(a);r&&i&&i+r>Date.now()?(t=!0,setTimeout((function(){c()}),r+1e3)):localStorage.removeItem(e)}o(t)}),[e,n]);return Object(a.useEffect)((function(){c()}),[c]),{isSnoozed:i,snooze:Object(a.useCallback)((function(){n>0&&(localStorage.setItem(e,Date.now().toString()),c())}),[e,n,c])}}},"./node_modules/css-loader/index.js?!./node_modules/postcss-loader/src/index.js?!./node_modules/less-loader/dist/cjs.js?!./app/src/components/EmailHygieneWizard/EmailHygieneBanner.less":function(e,n,t){(n=e.exports=t("./node_modules/css-loader/lib/css-base.js")(!1)).push([e.i,"._3_IIx3qL7PLWV0{padding:0;text-align:center;background-color:#172b4d}.y713MCtKnRL7Xv{color:#dfe1e6;line-height:32px;margin:0}.y713MCtKnRL7Xv ._3DtarySw4qn2vr,.y713MCtKnRL7Xv a{color:#97a0af;margin-left:8px}",""]),n.locals={banner:"_3_IIx3qL7PLWV0",text:"y713MCtKnRL7Xv",linkSeparator:"_3DtarySw4qn2vr"}}}]);
//# sourceMappingURL=email-hygiene-banner.d44bdc86ea921378c922.js.map